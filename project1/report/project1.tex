\documentclass[11pt]{article}

\usepackage[letterpaper]{geometry}
%\usepackage[letterpaper,left=2.5cm,top=2cm,right=2.5cm,bottom=2cm]{geometry}

\usepackage[utf8]{inputenc}
\usepackage{mathpazo}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{siunitx}
\usepackage{cancel}

\usepackage{graphicx}
\usepackage{float}
\usepackage{empheq}
\usepackage[most]{tcolorbox}

\newtcbox{\mymath}[1][]{%
  nobeforeafter, math upper, tcbox raise base,
  enhanced, colframe=black!30!black,
  colback=yellow!30, boxrule=1pt,
  #1}

% Hyperlinks with decent looking default colors.
\usepackage{hyperref}
\usepackage{xcolor}
\hypersetup{
  colorlinks,
  linkcolor={red!50!black},
  citecolor={blue!50!black},
  urlcolor={blue!80!black}
}

% For those sexy spaced low small caps from classic-thesis!
\usepackage{microtype}
\usepackage{textcase}
\DeclareRobustCommand{\spacedlowsmallcaps}[1]{%
  \textls[80]{\scshape\MakeTextLowercase{#1}}%
}

\usepackage{fancyhdr}
\pagestyle{fancy} 
\fancyhead{}
\rhead{Ali Ramadhan}
\lhead{6.339 Project 1---Finite Difference Methods}
\cfoot{\thepage}

\title{\spacedlowsmallcaps{6.339: Numerical Methods for Partial Differential Equations}\\ \spacedlowsmallcaps{Project one: Finite Difference Methods}}
\author{Ali Ramadhan$^\text{†}$ (\texttt{alir@mit.edu})}
\date{\textit{$^\text{†}$Department of Earth, Atmospheric, and Planetary Sciences}}

\renewcommand\thesection{\Alph{section}}

\begin{document}
\maketitle

In this project, we will utilize finite difference methods to solve the two-dimensional time-dependent Euler equations, a set of quasilinear hyperbolic partial differential equations, for the pressure field of a fluid flowing around a small perturbative bump.


The Euler equations mathematically represent the conservation of mass and momentum for a fluid and can be used to describe the flow of an inviscid fluid. They can be written as

\begin{subequations}
\begin{align} 
\frac{D\mathbf{u}}{Dt} = - \nabla w + \mathbf{g} \\
\nabla\cdot\mathbf{u} = 0
\end{align}
\end{subequations}

Before tackling the questions, I will first introduce the finite difference operators that I use. A second-order finite-difference approximation for the first derivative of an arbitrary real-valued and sufficiently differentiable multivariable function $f = f(x)$ on a grid, as we saw in class, would be 
\begin{equation} \label{eq:firstD}
\frac{\partial f(x_i)}{\partial x} = \frac{f(x_{i+1}) - f(x_{i-1})}{2\Delta x} + \mathcal{O}(\Delta x)^2
\end{equation}
where $\Delta x$ is the spacing between two successive uniformly distributed grid points, while the second derivative can be approximated as
\begin{equation} \label{eq:secondD}
\frac{\partial^2 f(x_i)}{\partial x^2} = \frac{f(x_{i+1}) - 2f(x_i) + f(x_{i-1})}{(\Delta x)^2} + \mathcal{O}(\Delta x)^2
\end{equation}
and together they can be used to discretize the governing Euler equations in space. Both finite difference operators \eqref{eq:firstD} and \eqref{eq:secondD} accurately approximate the derivatives up to a truncation error on the order of $(\Delta x)^2$, thus their classification as second-order operators. It will also be useful at certain points to introduce the second-order forward difference operator
\begin{equation} \label{eq:firstDforward}
\frac{\partial f(x_i)}{\partial x} = \frac{-3f(x_{i}) + 4f(x_{i+1}) - f(x_{i+2})}{2\Delta x} + \mathcal{O}(\Delta x)^2
\end{equation}
along with the second-order backward difference operator
\begin{equation} \label{eq:firstDbackward}
\frac{\partial f(x_i)}{\partial x} = \frac{3f(x_{i}) - 4f(x_{i-1}) + f(x_{i-2})}{2\Delta x} + \mathcal{O}(\Delta x)^2
\end{equation}
and the second-order mixed derivative operator assuming that $f$ is now a multivariable function $f = f(x,y)$ with sufficiently smooth derivatives,
\begin{equation}
\frac{\partial^2 f_{i,j}}{\partial x \partial y} = \frac{f_{i+1,j+1} - f_{i+1,j-1} - f_{i-1,j+1} + f_{i-1,j-1}}{4\Delta x \Delta y} + \mathcal{O}(\Delta x^2, \Delta y^2)
\end{equation}
where we have introduced the shorthand notation $f(x_i,y_j) \equiv f_{i,j}$ for brevity.

\begin{tcolorbox}
  \textit{Question 1(a)---Derive the governing boundary condition for $p'$ on boundary. The error in the boundary condition you derived should be the same as that in the linearized Euler equation.}
\end{tcolorbox}

The bottom ($y=0$) and top ($y=H$) boundary conditions read
\begin{equation} \label{eq:yBC}
\nabla p \cdot \mathbf{n} = -\rho \left( \frac{\partial^2 F}{\partial t^2} + 2u\frac{\partial^2 F}{\partial t \partial x} + u^2 \frac{\partial^2 F}{\partial^2 x} \right)
\end{equation}
where $F(x,t)$ describes the geometry for the lower and upper walls and $\mathbf{n}$ is the normal vector pointing into the flow field such that $\mathbf{n} = (F_x, -1)$ for the top wall and $\mathbf{n} = (-F_x, 1)$ for the bottom wall.

Expanding the gradient term in \eqref{eq:yBC} we obtain 
\begin{equation*}
  \nabla p = \nabla(p_0 + p') = \cancelto{0}{\nabla p_0} + \nabla p' = \nabla p'
\end{equation*}
where $\nabla p_0 = 0$ as $p_0$ represents the unperturbed pressure field and thus does not vary in time or space for our problem.

\begin{tcolorbox}
  \textit{Question 1(b)---Derive a numerical scheme for the governing equation, using second-order finite-difference in space.}
\end{tcolorbox}
Taking a look at $p' = p'(x,y,t)$ first, which is the perturbed pressure field of the fluid flow, its governing equation can be written as
\begin{equation}
  \frac{\partial p'}{\partial t} + \mathbf{u}_0 \cdot \nabla p' = q'
\end{equation}
where $\mathbf{u}_0 = (u_0, v_0)$ is the unperturbed fluid flow velocity vector and
\begin{equation*}
  q' = \frac{Dp'}{Dt} \equiv \frac{\partial p'}{\partial t} + \mathbf{u}_0 \cdot \nabla p'
\end{equation*}
is the \emph{material derivative} of $p'$. Expanding the dot product and gradient, the governing equation can be written as
\begin{equation} \label{eq:govpp}
\frac{\partial p'}{\partial t} = q' - u_0 \frac{\partial p'}{\partial x} - v_0 \frac{\partial p'}{\partial y}
\end{equation}
where we haved moved the $\mathbf{u}_0 \nabla p'$ term to the right hand side. Now we can discretize the spatial derivatives using \eqref{eq:firstD} to obtain
\begin{empheq}[box=\mymath]{equation} \label{eq:ppDisc}
  \frac{dp'_{i,j}}{dt} = q'_{i,j} - u_0\frac{p'_{i+1,j} - p'_{i-1,j}}{2\Delta x} - v_0 \frac{p'_{i,j+1} - p'_{i,j-1}}{2\Delta y}.
\end{empheq}

The corresponding governing equation for $q'$ is
\begin{equation}
  \frac{\partial q'}{\partial t} + \mathbf{u}_0 \cdot \nabla q' = c_0^2 \nabla^2 p'
\end{equation}
where $c_0^2$ is the unperturbed speed of sound in the fluid. Expanding the dot product and the Laplacian terms, we arrive at
\begin{equation} \label{eq:govqp}
  \frac{\partial q'}{\partial t} = c_0^2 \left( \frac{\partial^2 p'}{\partial x^2} + \frac{\partial^2 p'}{\partial y^2}\right) - u_0 \frac{\partial q'}{\partial x} - v_0 \frac{\partial q'}{\partial y}
\end{equation}
where again we have moved the $\mathbf{u}_0 \cdot \nabla q'$ term to the right hand side and which we can now discretize using \eqref{eq:firstD} and \eqref{eq:secondD} to obtain
\begin{empheq}[box=\mymath]{multline} \label{eq:qpDisc}
  \frac{\partial q'_{i,j}}{\partial t} = c_0^2 \left( \frac{p'_{i+1,j} - 2p'_{i,j} + p'_{i-1,j}}{(\Delta x)^2} + \frac{p'_{i,j+1} - 2p'_{i,j} + p'_{i,j-1}}{(\Delta y^2)} \right) \\
  - u_0\frac{q'_{i+1,j} - q'_{i-1,j}}{2\Delta x} - v_0 \frac{q'_{i,j+1} - q'_{i,j-1}}{2\Delta y}.
\end{empheq}

Equations \eqref{eq:ppDisc} and \eqref{eq:qpDisc} each provide us with a set of $(N+1)(M+1)$ ordinary differential equations (ODEs) that may be integrated numerically to obtain the values of $p'$ and $q'$ at each grid point as a function of time, but we also require appropriate boundary conditions. Let us look at the boundary conditions for $p'$ first. The left boundary condition reads $p = p_0$ at $x = 0$ but $p = p_0 + p'$ by definition so we must have that $p' = 0$ at $x = 0$ or
\begin{empheq}[box=\mymath]{equation}
  p'_{0,j} = 0 \quad \mathrm{for \; all} \; j
\end{empheq}
The right boundary condition reads $\displaystyle \frac{dp'}{dx'} = 0$ which we can discretize using \eqref{eq:firstD} to get
\begin{equation}
  \frac{p'_{N+1,j} - p'_{N,j}}{2\Delta x} = 0
\end{equation}
or rather, that the boundary grid points must equal the ones to their left,
\begin{empheq}[box=\mymath]{equation}
   p'_{N+1,j} = p'_{N,j} \quad \mathrm{for \; all} \; j
\end{empheq}

The bottom ($y=0$) and top ($y=H$) boundary condition reads 
\begin{equation}
  \nabla p \cdot \mathbf{n} = -\rho \left( \frac{\partial^2 F}{\partial t^2} + 2u\frac{\partial^2 F}{\partial t \partial x} + u^2 \frac{\partial^2 F}{\partial^2 x} \right)
\end{equation}
where $F(x,t)$ describes the geometry for the lower and upper walls and $\mathbf{n}$ is the normal vector pointing into the flow field such that $\mathbf{n} = (F_x, -1)$ for the top wall and $\mathbf{n} = (-F_x, 1)$ for the bottom wall.

Now taking a look at the boundary conditions for $q'$, the condition on the left wall reads $q' = 0$ at $x = 0$ which may be discretized as
\begin{empheq}[box=\mymath]{equation}
  q'_{0,j} = 0 \quad \mathrm{for \; all} \; j
\end{empheq}


\begin{tcolorbox}
  \textit{Question 2(a)---On a bump described by function:}
  \begin{equation*}
    F(x) = 0.01 \left\{ 1 - \cos \left[ \frac{8\pi}{L} \left( x - \frac{L}{4} \right) \right] \right\}^2
  \end{equation*}
  \textit{Plot the contour for $p'$ at time $t=2$ in your report (no figure
  generation in submitted code). Include the color-bar in the figure.}
\end{tcolorbox}

\begin{tcolorbox}
  \textit{Question 3(a)---Estimate what the twist angle $\theta$ should be, so that the mesh aligns with the features of the solution.}
\end{tcolorbox}
We can manually measure the angle from figure 1. Choosing a vector $\mathbf{x}_1 = (1.74, 0)$ from the origin to the bottom left corner of the high pressure region to the left of the bump, and another vector $\mathbf{x}_2 = (1.14, 1.133)$ from $\mathbf{x}_1$ to along the high pressure region's straight left boundary, we can calculate the angle between the two vector using
\begin{equation}
  \theta = \arccos \frac{\mathbf{x}_1 \cdot \mathbf{x}_2}{\left\lVert\mathbf{x}_1\right\rVert \left\lVert\mathbf{x}_2\right\rVert} \approx \frac{\pi}{4}
\end{equation}
which results in an angle very close to $45^\circ$. Thus it makes sense to choose $\theta = \pi/4$ for the oblique mesh.

\begin{tcolorbox}
  \textit{Question 3(b)---Derive the governing equation on this new mesh.}
\end{tcolorbox}
To do so we will make a coordinate transformation from Cartesian coordinates $(x,y)$ to the oblique coordinate system, which we will denote by $(\tilde{x}, \tilde{y})$. The transformation is given by
\begin{subequations}
\begin{align}
  \tilde{x} &= x - y\tan\theta \\
  \tilde{y} &= y\sec\theta
\end{align}
\end{subequations}
which will transform the differential operators according the chain rule,
\begin{align*}
  \frac{\partial f}{\partial x} &= \frac{\partial f}{\partial \tilde{x}} \frac{\partial \tilde{x}}{\partial x}
  + \frac{\partial f}{\partial \tilde{y}} \frac{\partial \tilde{y}}{\partial x} = \frac{\partial f}{\partial \tilde{x}} \\
  \frac{\partial f}{\partial y} &= \frac{\partial f}{\partial \tilde{x}} \frac{\partial \tilde{x}}{\partial y}
  + \frac{\partial f}{\partial \tilde{y}} \frac{\partial \tilde{y}}{\partial y} = -\tan\theta\frac{\partial f}{\partial \tilde{x}} + \sec\theta \frac{\partial f}{\partial \tilde{y}}
\end{align*}
so that they can be substituted by differential operators with respect to the oblique coordinate system
\begin{subequations}
\begin{align}
  \frac{\partial}{\partial x} &\rightarrow \frac{\partial}{\partial \tilde{x}} \label{eq:NewDOx} \\
  \frac{\partial}{\partial y} &\rightarrow -\tan\theta\frac{\partial}{\partial \tilde{x}} + \sec\theta\frac{\partial}{\partial \tilde{y}} \label{eq:NewDOy}
\end{align}
\end{subequations}

Substituting our new differential operators \eqref{eq:NewDOx} and \eqref{eq:NewDOy} into the governing equation for $p'$ \eqref{eq:govpp} we get
\begin{equation} \label{eq:govppTilde}
\frac{\partial p'}{\partial t} = q' - u_0 \frac{\partial p'}{\partial \tilde{x}} - v_0 \left( -\tan\theta \frac{\partial p'}{\partial \tilde{x}} + \sec\theta  \frac{\partial p'}{\partial \tilde{y}} \right)
\end{equation}
and doing the same for the governing equation for $q'$ \eqref{eq:govqp} we get
\begin{multline} \label{eq:govqpTilde}
\frac{\partial q'}{\partial t} =
  c_0^2 \left( \sec^2\theta \frac{\partial^2 p'}{\partial \tilde{x}^2} + \sec^2\theta \frac{\partial^2 p'}{\partial \tilde{y}^2} - 2\sec\theta\tan\theta \frac{\partial^2 p'}{\partial\tilde{x} \partial\tilde{y}} \right) \\
  - u_0 \frac{\partial q'}{\partial \tilde{x}}
  - v_0 \left( -\tan\theta \frac{\partial q'}{\partial \tilde{x}} + \sec\theta \frac{\partial p'}{\partial \tilde{y}} \right)
\end{multline}

The boundary condition at the bottom wall now becomes more complicated involving multiple derivatives,
\begin{equation}
\tan\theta \frac{\partial p'}{\partial \tilde{x}} - \sec\theta \frac{\partial p'}{\partial \tilde{y}} = -\rho_0 u_0^2 \frac{\partial^2F}{\partial \tilde{x}^2}, \quad \frac{L}{4} < x < \frac{L}{2}
\end{equation}
while the boundary condition at the top wall ($\tilde{y}=H$) is slightly simpler,
\begin{equation}
  \tan\theta \frac{\partial p'}{\partial \tilde{x}} - \sec\theta \frac{\partial p'}{\partial \tilde{y}} = 0
\end{equation}

\begin{tcolorbox}
  \textit{Question 3(c)---Derive a numerical scheme for the governing equation, using second-order finite-difference in space.}
\end{tcolorbox}
We will again take $v_0 = 0$, which will simplify the governing equations. Using the central difference finite-difference operator \eqref{eq:firstD} for the first derivative we can discretize the governing equation for $p'$ in the oblique coordinate system \eqref{eq:govppTilde} as
\begin{empheq}[box=\mymath]{equation} \label{eq:ppDiscTilde}
\frac{dp'_{i,j}}{dt} = q'_{i,j} - u_0\frac{p'_{i+1,j} - p'_{i-1,j}}{2\Delta \tilde{x}}
\end{empheq}
and results in exactly the same discretization used previously [see equation \eqref{eq:ppDisc}]. Utilizing the finite-difference operator for the second derivative \eqref{eq:secondD} and the finite-difference operator for the mixed second derivative we can also discretize the governing equation for $q'$ in the oblique coordinate system as
\begin{empheq}[box=\mymath]{multline} \label{eq:qpDiscTilde}
\frac{\partial q'_{i,j}}{\partial t} =
  c_0^2 \left(
    \sec^2\theta \frac{p'_{i+1,j} - 2p'_{i,j} + p'_{i-1,j}}{(\Delta \tilde{x})^2}
    + \sec^2\theta \frac{p'_{i,j+1} - 2p'_{i,j} + p'_{i,j-1}}{(\Delta \tilde{y}^2)} \right. \\ \left.
    - 2\sec\theta\tan\theta \frac{p'_{i+1,j+1} - p'_{i+1,j-1} - p'_{i-1,j+1} + p'_{i-1,j-1}}{4\Delta\tilde{x}\Delta\tilde{y}} \right)
- u_0\frac{q'_{i+1,j} - q'_{i-1,j}}{2\Delta\tilde{x}}.
\end{empheq}

Using a second-order backward difference operator, the $\tilde{y}=H$ boundary condition can be written as a system of $N+1$ linear equations for the value of $p'$, or more specifically, for the $N+1$ unknown values $p'_{i,M+1}$ along the $\tilde{y}=H$ boundary,
\begin{equation}
  \frac{\tan\theta}{2\Delta\tilde{x}} p'_{i-1,M+1}
  + \frac{3\sec\theta}{2\Delta\tilde{y}} p'_{i,M+1}
  - \frac{\tan\theta}{2\Delta\tilde{x}} p'_{i+1,M+1}
  = \sec\theta \frac{4p'_{i,M} - p'_{i,M-1}}{2\Delta\tilde{y}}
\end{equation}
and a similar process for the $\tilde{y}=0$ boundary condition, except for the use of a second-order forward difference operator, produces another system of linear equations for the $N+1$ unknown values $p'_{i,1}$ along the $\tilde{y}=0$ boundary,
\begin{equation}
  \frac{\tan\theta}{2\Delta\tilde{x}} p'_{i-1,1}
- \frac{3\sec\theta}{2\Delta\tilde{y}} p'_{i,1}
- \frac{\tan\theta}{2\Delta\tilde{x}} p'_{i+1,1}
= - \sec\theta \frac{4p'_{i,2} - p'_{i,3}}{2\Delta\tilde{y}}
- \rho_0 u_0^2 \frac{F_{i+1} - 2F_i + F_{i-1}}{(\Delta\tilde{x})^2}
\end{equation}
both of which may be easily solved in MATLAB due to their relatively small size.

\begin{tcolorbox}
  \textit{Question 4---Same as question 2.}
\end{tcolorbox}
The highlighted/boxed equations from question (3b) together form the discretization we will use in the oblique coordinate system.

\end{document}